<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Surfing With Style">
    <link rel="icon" href="http://surfingwithstyle.com//favicon.ico">
    <title>Pandas - Surfing With Style</title>
    <link href="http://fonts.googleapis.com/css?family=PT+Sans:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet"
        href="http://surfingwithstyle.com//css/highlight/github.css">
    
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="http://surfingwithstyle.com//css/theme.css">
    <link rel="stylesheet" href="http://surfingwithstyle.com//css/bootie-docs.css">
    <link rel="stylesheet" href="http://surfingwithstyle.com//css/site.css">
    <link rel="stylesheet" href="http://surfingwithstyle.com//css/math.css">
    <link rel="stylesheet" href="http://surfingwithstyle.com//css/metronome.css">
    <link rel="stylesheet" href="http://surfingwithstyle.com//css/mini-metronome.css">
    <link rel="stylesheet" href="http://surfingwithstyle.com//css/calculator.css">
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML"></script>
</head>

<body role="document">

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="http://surfingwithstyle.com//">Surfing With Style</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                
                
                
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Tools
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        
                        
                        <a class="dropdown-item" href="/tools/timer/">Timer</a>
                        
                        
                        
                        <a class="dropdown-item" href="/tools/calculator/">Calculator</a>
                        
                        
                        
                        <a class="dropdown-item" href="/tools/old-english-letters/">Old English Letters</a>
                        
                        
                    </div>
                </li>
                
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Study
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        
                        
                        <a class="dropdown-item" href="/study/flashcards/">Flashcards</a>
                        
                        
                    </div>
                </li>
                
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Practice
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        
                        
                        <a class="dropdown-item" href="/practice/metronome/">Metronome</a>
                        
                        
                        
                        <a class="dropdown-item" href="/practice/scheduled-metronome/">Scheduled Metronome</a>
                        
                        
                        
                        <a class="dropdown-item" href="/practice/accelerating-metronome/">Accelerating Metronome</a>
                        
                        
                        
                        <a class="dropdown-item" href="/practice/scheduled-metronome-presets/">Presets</a>
                        
                        
                        
                        <a class="dropdown-item" href="/practice/chords/">Chords</a>
                        
                        
                    </div>
                </li>
                
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Notes
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        
                        
                        <a class="dropdown-item" href="/notes/data-science/">Data Science</a>
                        
                        
                        
                        <a class="dropdown-item" href="/notes/ms/">MS</a>
                        
                        
                        
                        <a class="dropdown-item" href="/notes/python/">Python</a>
                        
                        
                        
                        <a class="dropdown-item" href="/notes/designpatterns/">Design Patterns</a>
                        
                        
                        
                        <a class="dropdown-item" href="/notes/git/">Git</a>
                        
                        
                        
                        <a class="dropdown-item" href="/notes/solid/">SOLID</a>
                        
                        
                        
                        <a class="dropdown-item" href="/notes/sql/">SQL</a>
                        
                        
                        
                        <a class="dropdown-item" href="">Other ...</a>
                        
                        
                    </div>
                </li>
                
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Links
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        
                        
                        <a class="dropdown-item" href="">Tools2</a>
                        
                        
                        
                        <a class="dropdown-item" href="">Books</a>
                        
                        
                    </div>
                </li>
                
                

                


                
            </ul>
            
        </div>
    </nav>

    <div class="container">

<div class="row">
	<div class="col-sm-offset-2 col-sm-8 doc-main">
		<main role="main">
			<article>
				<a id="title"></a>
				<h1 class="doc-entry-title">Pandas</h1>
				<div class="doc-entry-meta">
					<span><time datetime="2020-06-18">June 18, 2020</time></span>
				</div>
				<section>
					<h1 id="pandas">pandas</h1>
<p>Links:<br>
<a href="https://pandas.pydata.org/">pandas</a><br>
<a href="/pdf/PandasPythonForDataScience.pdf">Cheat Sheet 1 (PDF)</a><br>
<a href="/pdf/numpy_pandas_cheatsheet.pdf">Cheat Sheet 2 (PDF)</a><br>
<a href="https://pandas.pydata.org/pandas-docs/stable/getting_started/10min.html">10 Minutes to pandas</a><br>
<a href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html">Pandas Basic Functionality</a><br>
<a href="https://www.linkedin.com/pulse/data-science-test-driven-development-sam-savage/">Data Science TDD</a><br>
<a href="http://engineering.pivotal.io/post/test-driven-development-for-data-science/">TDD for Data Science</a><br>
<a href="https://medium.com/@@karijdempsey/test-driven-development-is-essential-for-good-data-science-heres-why-db7975a03a44">TDD is Essential for Good Data Science Here&rsquo;s Why</a><br>
<a href="http://docs.python-guide.org/en/latest/writing/tests/">Testing Your Code (general python TDD)</a><br>
<a href="https://github.com/lyst/MakingLyst/tree/master/code-reviews">Code Review</a><br>
<a href="https://www.kevinlondon.com/2015/05/05/code-review-best-practices.html">Code Review Best Practices</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># load DataFrame</span>
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;student_scores.csv&#39;</span>, index_col<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ID&#39;</span>)

<span style="color:#75715e"># save DataFrame</span>
df_powerplant<span style="color:#f92672">.</span>to_csv(<span style="color:#e6db74">&#39;powerplant_data_edited.csv&#39;</span>, index<span style="color:#f92672">=</span>False)

Pandas actually stores pointers to strings <span style="color:#f92672">in</span> dataframes <span style="color:#f92672">and</span> series, which <span style="color:#f92672">is</span> why object instead of str appears <span style="color:#66d9ef">as</span> the datatype<span style="color:#f92672">.</span>

<span style="color:#75715e"># inspect DataFrame</span>
df<span style="color:#f92672">.</span>head()
df<span style="color:#f92672">.</span>info()
df<span style="color:#f92672">.</span>nunique()
df<span style="color:#f92672">.</span>describe() <span style="color:#75715e"># descriptive statistics for each column of data</span>

df<span style="color:#f92672">.</span>tail()
df<span style="color:#f92672">.</span>sample()
df<span style="color:#f92672">.</span>shape
df<span style="color:#f92672">.</span>dtypes
df[col]<span style="color:#f92672">.</span>value_counts()
df<span style="color:#f92672">.</span>hist();
sns<span style="color:#f92672">.</span>heatmap(df<span style="color:#f92672">.</span>corr(), annot<span style="color:#f92672">=</span>True, fmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;.2f&#39;</span>);

<span style="color:#75715e"># select all the columns from &#39;id&#39; to the last mean column</span>
df_means <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>loc[:,<span style="color:#e6db74">&#39;id&#39;</span>:<span style="color:#e6db74">&#39;fractal_dimension_mean&#39;</span>]

<span style="color:#75715e"># repeat the step above using index numbers</span>
df_means <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>iloc[:,:<span style="color:#ae81ff">11</span>]

<span style="color:#75715e"># pick and choose columns with np.r_ and df.iloc</span>
cols <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>r_[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">22</span>]
df_stderr <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>iloc[:, cols]

<span style="color:#75715e"># fill missing data with mean</span>
mean <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;view_duration&#39;</span>]<span style="color:#f92672">.</span>mean()
df[<span style="color:#e6db74">&#39;view_duration&#39;</span>]<span style="color:#f92672">.</span>fillna(mean, inplace<span style="color:#f92672">=</span>True)

<span style="color:#75715e"># duplicates</span>
df<span style="color:#f92672">.</span>duplicated()
sum(df<span style="color:#f92672">.</span>duplicated())
df<span style="color:#f92672">.</span>drop_duplicates(inplace<span style="color:#f92672">=</span>True)

<span style="color:#75715e"># find rows with nulls</span>
sum(df_08<span style="color:#f92672">.</span>isnull()<span style="color:#f92672">.</span>any(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>))

<span style="color:#75715e"># convert text to datetime</span>
df[<span style="color:#e6db74">&#39;timestamp&#39;</span>] <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>to_datetime(df[<span style="color:#e6db74">&#39;timestamp&#39;</span>])

<span style="color:#75715e"># pandas uses Matplotlib as a back end</span>
<span style="color:#f92672">%</span>matplotlib inline

<span style="color:#75715e"># semicolon suppresses unwanted output</span>
df<span style="color:#f92672">.</span>hist(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">8</span>));

<span style="color:#75715e"># bar chart</span>
df_census[<span style="color:#e6db74">&#39;education&#39;</span>]<span style="color:#f92672">.</span>value_counts()<span style="color:#f92672">.</span>plot(kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bar&#39;</span>)

<span style="color:#75715e"># pie chart</span>
df_census[<span style="color:#e6db74">&#39;workclass&#39;</span>]<span style="color:#f92672">.</span>value_counts()<span style="color:#f92672">.</span>plot(kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;pie&#39;</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">8</span>))

<span style="color:#75715e"># scatter plots</span>
pd<span style="color:#f92672">.</span>plotting<span style="color:#f92672">.</span>scatter_matrix(df_cancer, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">15</span>));
df_cancer<span style="color:#f92672">.</span>plot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;compactness&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;concavity&#39;</span>, kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;scatter&#39;</span>);

<span style="color:#75715e"># box plots</span>
df_cancer[<span style="color:#e6db74">&#39;concave_points&#39;</span>]<span style="color:#f92672">.</span>plot(kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;box&#39;</span>);

<span style="color:#75715e"># filter data</span>
df_m <span style="color:#f92672">=</span> df[df[<span style="color:#e6db74">&#39;diagnosis&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;M&#39;</span>]

<span style="color:#75715e"># order multiple bar charts with the same index</span>
ind <span style="color:#f92672">=</span> df_x[<span style="color:#e6db74">&#39;education&#39;</span>]<span style="color:#f92672">.</span>value_counts()<span style="color:#f92672">.</span>index
df_a[<span style="color:#e6db74">&#39;education&#39;</span>]<span style="color:#f92672">.</span>value_counts()[ind]<span style="color:#f92672">.</span>plot(kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bar&#39;</span>);
df_b[<span style="color:#e6db74">&#39;education&#39;</span>]<span style="color:#f92672">.</span>value_counts()[ind]<span style="color:#f92672">.</span>plot(kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bar&#39;</span>);

<span style="color:#75715e"># Find the mean quality of each wine type (red and white) with groupby</span>
grouped <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;color&#39;</span>)

<span style="color:#75715e"># Creates acidity_levels column</span>
df[<span style="color:#e6db74">&#39;acidity_levels&#39;</span>] <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>cut(df[<span style="color:#e6db74">&#39;pH&#39;</span>], bin_edges, labels<span style="color:#f92672">=</span>bin_names)

<span style="color:#75715e"># query() is equivalent to selecting with a mask</span>
df_m <span style="color:#f92672">=</span> df[df[<span style="color:#e6db74">&#39;diagnosis&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;M&#39;</span>]
df_m <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#39;diagnosis == &#34;M&#34;&#39;</span>)

<span style="color:#75715e"># get unique values in a column</span>
df_08<span style="color:#f92672">.</span>Fuel<span style="color:#f92672">.</span>unique()

<span style="color:#75715e"># drop columns from 2008 dataset</span>
df_08<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#39;Stnd&#39;</span>, <span style="color:#e6db74">&#39;Underhood ID&#39;</span>, <span style="color:#e6db74">&#39;FE Calc Appr&#39;</span>, <span style="color:#e6db74">&#39;Unadj Cmb MPG&#39;</span>], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, inplace<span style="color:#f92672">=</span>True)

<span style="color:#75715e"># rename Sales Area to Cert Region</span>
df_08<span style="color:#f92672">.</span>rename(index<span style="color:#f92672">=</span>str, columns<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;Sales Area&#34;</span>: <span style="color:#e6db74">&#34;Cert Region&#34;</span>}, inplace<span style="color:#f92672">=</span>True)

<span style="color:#75715e"># replace spaces with underscores and lowercase labels for 2008 dataset</span>
df_08<span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> x: x<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34; &#34;</span>, <span style="color:#e6db74">&#34;_&#34;</span>), inplace<span style="color:#f92672">=</span>True)

<span style="color:#75715e"># confirm column labels for 2008 and 2018 datasets are identical</span>
df_08<span style="color:#f92672">.</span>columns <span style="color:#f92672">==</span> df_18<span style="color:#f92672">.</span>columns

<span style="color:#75715e"># make sure they&#39;re all identical like this</span>
(df_08<span style="color:#f92672">.</span>columns <span style="color:#f92672">==</span> df_18<span style="color:#f92672">.</span>columns)<span style="color:#f92672">.</span>all()

<span style="color:#75715e"># drop rows with any null values</span>
df_08<span style="color:#f92672">.</span>dropna(inplace<span style="color:#f92672">=</span>True)

<span style="color:#75715e"># check values in a specific column</span>
df_08[<span style="color:#e6db74">&#39;cyl&#39;</span>]<span style="color:#f92672">.</span>value_counts()

<span style="color:#75715e"># Extract int from strings in the 2008 cyl column</span>
df_08[<span style="color:#e6db74">&#39;cyl&#39;</span>] <span style="color:#f92672">=</span> df_08[<span style="color:#e6db74">&#39;cyl&#39;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>extract(<span style="color:#e6db74">&#39;(\d+)&#39;</span>)<span style="color:#f92672">.</span>astype(int)

<span style="color:#75715e"># merge datasets</span>
df_combined <span style="color:#f92672">=</span> df_08<span style="color:#f92672">.</span>merge(df_18, left_on<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;model_2008&#39;</span>, right_on<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;model&#39;</span>, how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;inner&#39;</span>)

<span style="color:#75715e"># Cookbook recipe: convert type of multiple columns</span>
mpg_columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;city_mpg&#39;</span>, <span style="color:#e6db74">&#39;hwy_mpg&#39;</span>, <span style="color:#e6db74">&#39;cmb_mpg&#39;</span>]
<span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> mpg_columns:
    df_18[c] <span style="color:#f92672">=</span> df_18[c]<span style="color:#f92672">.</span>astype(float)
    df_08[c] <span style="color:#f92672">=</span> df_08[c]<span style="color:#f92672">.</span>astype(float)

<span style="color:#75715e"># Cookbook recipe: fix data with 2 entries in one field</span>
hb_08 <span style="color:#f92672">=</span> df_08[df_08[<span style="color:#e6db74">&#39;fuel&#39;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>contains(<span style="color:#e6db74">&#39;/&#39;</span>)]
df1 <span style="color:#f92672">=</span> hb_08<span style="color:#f92672">.</span>copy()  <span style="color:#75715e"># data on first fuel type of each hybrid vehicle</span>
df2 <span style="color:#f92672">=</span> hb_08<span style="color:#f92672">.</span>copy()  <span style="color:#75715e"># data on second fuel type of each hybrid vehicle</span>
<span style="color:#75715e"># columns to split by &#34;/&#34;</span>
split_columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;fuel&#39;</span>, <span style="color:#e6db74">&#39;air_pollution_score&#39;</span>, <span style="color:#e6db74">&#39;city_mpg&#39;</span>, <span style="color:#e6db74">&#39;hwy_mpg&#39;</span>, <span style="color:#e6db74">&#39;cmb_mpg&#39;</span>, <span style="color:#e6db74">&#39;greenhouse_gas_score&#39;</span>]
<span style="color:#75715e"># apply split function to each column of each dataframe copy</span>
<span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> split_columns:
    df1[c] <span style="color:#f92672">=</span> df1[c]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: x<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;/&#34;</span>)[<span style="color:#ae81ff">0</span>])
    df2[c] <span style="color:#f92672">=</span> df2[c]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: x<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;/&#34;</span>)[<span style="color:#ae81ff">1</span>])
new_rows <span style="color:#f92672">=</span> df1<span style="color:#f92672">.</span>append(df2)
<span style="color:#75715e"># drop the original hybrid rows</span>
df_08<span style="color:#f92672">.</span>drop(hb_08<span style="color:#f92672">.</span>index, inplace<span style="color:#f92672">=</span>True)
<span style="color:#75715e"># add in our newly separated rows</span>
df_08 <span style="color:#f92672">=</span> df_08<span style="color:#f92672">.</span>append(new_rows, ignore_index<span style="color:#f92672">=</span>True)

<span style="color:#75715e"># A Pandas series is like a numpy array with extra functionality, esp. index</span>

<span style="color:#75715e"># get item by position</span>
employment[i]
employment<span style="color:#f92672">.</span>iloc[i]

<span style="color:#75715e"># get item by key</span>
employment<span style="color:#f92672">.</span>loc[<span style="color:#e6db74">&#39;key&#39;</span>]

<span style="color:#75715e"># remove NaNs from a series</span>
s<span style="color:#f92672">.</span>dropna()

<span style="color:#75715e"># replace NaNs with a value</span>
s<span style="color:#f92672">.</span>fillna(<span style="color:#ae81ff">0</span>)

<span style="color:#75715e"># split a dataframe into X and y vectors</span>
X <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>iloc[:,:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
y <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>iloc[:,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]

<span style="color:#75715e"># or if y is an inner column</span>
outcomes <span style="color:#f92672">=</span> full_data[<span style="color:#e6db74">&#39;Survived&#39;</span>]
features_raw <span style="color:#f92672">=</span> full_data<span style="color:#f92672">.</span>drop(<span style="color:#e6db74">&#39;Survived&#39;</span>, axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># Split the data into features and target label</span>
income_raw <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#39;income&#39;</span>]
features_raw <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>drop(<span style="color:#e6db74">&#39;income&#39;</span>, axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># Log-transform the skewed features</span>
skewed <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;capital-gain&#39;</span>, <span style="color:#e6db74">&#39;capital-loss&#39;</span>]
features_log_transformed <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(data <span style="color:#f92672">=</span> features_raw)
features_log_transformed[skewed] <span style="color:#f92672">=</span> features_raw[skewed]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: np<span style="color:#f92672">.</span>log(x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>))

<span style="color:#75715e"># Normalize numerical features (including those that were just log-scaled)</span>
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> MinMaxScaler
scaler <span style="color:#f92672">=</span> MinMaxScaler() <span style="color:#75715e"># default=(0, 1)</span>
numerical <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;age&#39;</span>, <span style="color:#e6db74">&#39;education-num&#39;</span>, <span style="color:#e6db74">&#39;capital-gain&#39;</span>, <span style="color:#e6db74">&#39;capital-loss&#39;</span>, <span style="color:#e6db74">&#39;hours-per-week&#39;</span>]
features_log_minmax_transform <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(data <span style="color:#f92672">=</span> features_log_transformed)
features_log_minmax_transform[numerical] <span style="color:#f92672">=</span> scaler<span style="color:#f92672">.</span>fit_transform(features_log_transformed[numerical])

<span style="color:#75715e"># Convert categorical data with 2 categories to 0s and 1s</span>
features_raw[two_cat]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">if</span> x <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">1</span>))

<span style="color:#75715e"># One-hot encode categorical data with &amp;gt; 2 categores</span>
stripped <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: x<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>strip() <span style="color:#66d9ef">if</span> x<span style="color:#f92672">.</span>dtype <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;object&#39;</span> <span style="color:#66d9ef">else</span> x)
df2 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>get_dummies(stripped, columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;body_style&#34;</span>, <span style="color:#e6db74">&#34;drive_wheels&#34;</span>], prefix<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;body&#34;</span>, <span style="color:#e6db74">&#34;drive&#34;</span>])

<span style="color:#75715e"># Split data into training and testing sets</span>
<span style="color:#f92672">from</span> sklearn.cross_validation <span style="color:#f92672">import</span> train_test_split
X_train, X_test, y_train, y_test <span style="color:#f92672">=</span> train_test_split(features_final, 
                                                    income, 
                                                    test_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>, 
                                                    random_state <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)

<span style="color:#75715e"># linear regression</span>
<span style="color:#f92672">import</span> statsmodels.api <span style="color:#f92672">as</span> sm;
df[<span style="color:#e6db74">&#39;intercept&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
mod <span style="color:#f92672">=</span> sm<span style="color:#f92672">.</span>OLS(df[<span style="color:#e6db74">&#39;price&#39;</span>], df[[<span style="color:#e6db74">&#39;intercept&#39;</span>,<span style="color:#e6db74">&#39;area&#39;</span>]]) <span style="color:#75715e"># (y, X)</span>
res <span style="color:#f92672">=</span> mod<span style="color:#f92672">.</span>fit()
res<span style="color:#f92672">.</span>summary()

<span style="color:#75715e"># VIF factor</span>
<span style="color:#f92672">from</span> patsy <span style="color:#f92672">import</span> dmatrices
<span style="color:#f92672">import</span> statsmodels.api <span style="color:#f92672">as</span> sm;
<span style="color:#f92672">from</span> statsmodels.stats.outliers_influence <span style="color:#f92672">import</span> variance_inflation_factor
y, X <span style="color:#f92672">=</span> dmatrices(<span style="color:#e6db74">&#39;price ~ area + bedrooms + bathrooms&#39;</span>, df, return_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dataframe&#39;</span>)
vif <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()
vif[<span style="color:#e6db74">&#34;VIF Factor&#34;</span>] <span style="color:#f92672">=</span> [variance_inflation_factor(X<span style="color:#f92672">.</span>values, i) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(X<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>])]
vif[<span style="color:#e6db74">&#34;features&#34;</span>] <span style="color:#f92672">=</span> X<span style="color:#f92672">.</span>columns
vif<span style="color:#f92672">.</span>round(<span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># logistic regression (see also scikit-learn)</span>
df[<span style="color:#e6db74">&#39;intercept&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
log_mod <span style="color:#f92672">=</span> sm<span style="color:#f92672">.</span>Logit(df[<span style="color:#e6db74">&#39;fraud&#39;</span>], df[[<span style="color:#e6db74">&#39;intercept&#39;</span>, <span style="color:#e6db74">&#39;weekday&#39;</span>, <span style="color:#e6db74">&#39;duration&#39;</span>]])
results <span style="color:#f92672">=</span> log_mod<span style="color:#f92672">.</span>fit()
results<span style="color:#f92672">.</span>summary()
np<span style="color:#f92672">.</span>exp(results<span style="color:#f92672">.</span>params)
<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>_

<span style="color:#75715e"># find missing values</span>
null_data <span style="color:#f92672">=</span> df[df<span style="color:#f92672">.</span>isnull()<span style="color:#f92672">.</span>any(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)]

<span style="color:#75715e"># find complete rows</span>
complete_data <span style="color:#f92672">=</span> df[df<span style="color:#f92672">.</span>notnull()<span style="color:#f92672">.</span>all(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)]

<span style="color:#75715e"># Drop only the rows with missing values in column 3.</span>
only3_drop <span style="color:#f92672">=</span> small_dataset<span style="color:#f92672">.</span>dropna(subset<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;col3&#39;</span>], how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;any&#39;</span>)

<span style="color:#75715e"># find Pearson&#39;s R between 2 columns</span>
df[<span style="color:#e6db74">&#39;hours-per-week&#39;</span>]<span style="color:#f92672">.</span>corr(df[<span style="color:#e6db74">&#39;capital-gain&#39;</span>])

<span style="color:#75715e"># find duplicate column names across tables</span>
all_columns <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>Series(list(patients) <span style="color:#f92672">+</span> list(treatments) <span style="color:#f92672">+</span> list(adverse_reactions))
all_columns[all_columns<span style="color:#f92672">.</span>duplicated()]

<span style="color:#75715e"># split data into test and train sets</span>
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> Imputer
imputer <span style="color:#f92672">=</span> Imputer()
columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;CareerSatisfaction&#39;</span>, <span style="color:#e6db74">&#39;HoursPerWeek&#39;</span>, <span style="color:#e6db74">&#39;JobSatisfaction&#39;</span>, <span style="color:#e6db74">&#39;StackOverflowSatisfaction&#39;</span>, <span style="color:#e6db74">&#39;Salary&#39;</span>]
Xy <span style="color:#f92672">=</span> df[columns]
Xy <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(imputer<span style="color:#f92672">.</span>fit_transform(Xy), columns<span style="color:#f92672">=</span>columns)
y <span style="color:#f92672">=</span> Xy[<span style="color:#e6db74">&#39;Salary&#39;</span>]
X <span style="color:#f92672">=</span> Xy<span style="color:#f92672">.</span>drop(<span style="color:#e6db74">&#39;Salary&#39;</span>, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
X_train, X_test, y_train, y_test <span style="color:#f92672">=</span> train_test_split(X, y, test_size <span style="color:#f92672">=</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">30</span>, random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">42</span>)

<span style="color:#75715e"># Subset to a dataframe only holding the categorical columns</span>
cat_df <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>select_dtypes(include<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;object&#39;</span>])
</code></pre></div><p>Questions to Ask Yourself When Conducting a Code Review</p>
<ul>
<li>Is the code clean and modular?
<ul>
<li>Can I understand the code easily?</li>
<li>Does it use meaningful names and whitespace?</li>
<li>Is there duplicated code?</li>
<li>Can you provide another layer of abstraction?</li>
<li>Is each function and module necessary?</li>
<li>Is each function or module too long?</li>
</ul>
</li>
<li>Is the code efficient?
<ul>
<li>Are there loops or other steps we can vectorize?</li>
<li>Can we use better data structures to optimize any steps?</li>
<li>Can we shorten the number of calculations needed for any steps?</li>
<li>Can we use generators or multiprocessing to optimize any steps?</li>
</ul>
</li>
<li>Is documentation effective?
<ul>
<li>Are in-line comments concise and meaningful?</li>
<li>Is there complex code that&rsquo;s missing documentation?</li>
<li>Do function use effective docstrings?</li>
<li>Is the necessary project documentation provided?</li>
</ul>
</li>
<li>Is the code well tested?
<ul>
<li>Does the code high test coverage?</li>
<li>Do tests check for interesting cases?</li>
<li>Are the tests readable?</li>
<li>Can the tests be made more efficient?</li>
</ul>
</li>
<li>Is the logging effective?
<ul>
<li>Are log messages clear, concise, and professional?</li>
<li>Do they include all relevant and useful information?</li>
<li>Do they use the appropriate logging level?</li>
</ul>
</li>
</ul>

				</section>
			</article>
		</main>
	</div> 

	

</div> 




</div> 

<footer class="doc-footer">
	
</footer>




<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>




<script src="http://surfingwithstyle.com//js/bootie-docs.js"></script>

</body>
</html>
